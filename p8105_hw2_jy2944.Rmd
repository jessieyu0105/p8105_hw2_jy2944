---
title: "p8105_hw2_jy2944"
author: "Jie Yu"
date: 2018-10-01
output: 
  github_document:
    toc: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE) # change the default global options in a document 

library(tidyverse)
library(readxl)

Sys.setenv(LANG = "en") # change the system warning from Chinese to English
```


# Problem 1

The problem focuses on NYC Transit data. 

### Data import and initial cleaning

```{r p1_initial_cleaning, message = FALSE}
# import data
transit_data = read_csv(file = "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  # clean names of the data frame
  janitor::clean_names() %>%  
  # select variables
  select(line:route11, entry, vending, entrance_type, ada) %>%
  # convert the variable entry from character to logical 
  mutate(entry = recode(entry, "YES" = TRUE, "NO" = FALSE))
```

The above data frame `transit_data` contains 19 variables, which are line, station name, station latitude, station longitude, route served (route 1 to 11), entry, vending, entrance type, and ADA compliance (variable name "ada").  

So far, I have cleaned names of the imported data frame, extracted the 19 variables which I need from the original dataset as well as placed the last 4 variables in a order that I want, and converted the variable entry from character (`YES` vs `NO`) to logical variable (`TRUE` vs `FALSE`).  

The dimension of the resulting dataset is `r nrow(transit_data)` x `r ncol(transit_data)`.  

Current data ar not tidy. The route variable is spread across eleven columns, which correspond to 11 routes. We need to fix that to make ourselves have only two columns for variable route: one for route number and one for route name.


### Some answers based on the data

* There are `r nrow(distinct(transit_data, line, station_name))` distinct stations. 


* `r transit_data %>% distinct(line, station_name, .keep_all = TRUE) %>% filter(ada == TRUE) %>% nrow()` stations are ADA compliant.

* The proportion of station entrances / exits without vending allow entrance is `r nrow(subset(transit_data, vending == "NO" & entry == TRUE)) / nrow(subset(transit_data, vending == "NO"))`.  


### Reformat the data

Then I reformat the data so that route number and route name are distinct variables.

```{r p1_reformat_route}
transit_data = transit_data %>%
  # take the columns of variable route into key-value pairs.
  gather(key = "route_number", value = "route_name", route1:route11) %>%
  # split variable route_number into two columns
  separate(route_number, into = c("route_str", "route_number"), sep = 5) %>%
  # remove the variable route_str
  select(-route_str)
```

There are `r transit_data %>% filter(route_name == "A") %>% nrow()` stations which serve the A train. 

Of the stations that serve the A train, `r transit_data %>% filter(route_name == "A") %>% filter(ada == TRUE) %>% nrow()` stations are ADA compliant.


# Problem 2

This problem uses the Mr. Trash Wheel dataset.

### Mr. Trash Wheel sheet

First, let us import data from Mr. Trash Wheel sheet and make a cleaning.

```{r trash_data_tidy}
# import data, specify the sheet and omit columns containing notes
trash_data = read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N258") %>%
  janitor::clean_names() %>%
  # tidy name
  rename(weight = weight_tons, volume = volume_cubic_yards) %>%
  # omit rows that do not include dempster-specific data
  filter(!is.na(dumpster)) %>%
  # round sports_balls to the nearest integer and convert it to integer variable
  mutate(sports_balls = as.integer(round(sports_balls)))
```


### Precipitation data for 2016 and 2017

Next, let us import data from 2016 & 2017 Precipitation sheets and tidy the precipitation data.

```{r precipitation_data_tidy}
# import precipitation data for 2016
precip_2016 = read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = "2016 Precipitation", range = "A2:B15") %>%
  janitor::clean_names() %>%
  # omit rows without month-specific data
  filter(!is.na(month)) %>%
  # add variable year
  mutate(year = "2016")

# import precipitation data for 2017
precip_2017 = read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = "2017 Precipitation", range = "A2:B15") %>%
  janitor::clean_names() %>%
  # omit rows without month-specific and precipitation-specific data
  filter(!is.na(month), !is.na(total)) %>%
  mutate(year = "2017")

# combine the dataset for 2016 and 2017
precipitation_data = bind_rows(precip_2016, precip_2017) %>%
  # convert month to a character variable
  mutate(month = c(month.name[1:12], month.name[1:8])) %>%
  # make the name much more specific
  rename(precipitation = total)

```


### Desription about these data

After the above steps, we got two resulting data frames, `trash_data` and `precipitation_data`.  

Data frame `trash_data` contains information related to trash in a dumpster between May 2014 and August 2017. There is `r nrow(trash_data)` observations and `r ncol(trash_data)` in total. Variables include the weight and the volume of trash in each observed dumpster, as well as the numbers of specific types of trash such as plastic bottle, cigarette butts, and sports balls. Another interesting variable in this data frame is homes powered, which denotes the number of homes being powered by electricity generated from the trash in a dumpster.  

* The average weight of trash in a dumpster in year 2014, 2015, and 2016 are `r round(mean(subset(trash_data, year == "2014")$weight), 2)` tons, `r round(mean(subset(trash_data, year == "2015")$weight), 2)` tons, and `r round(mean(subset(trash_data, year == "2016")$weight), 2)` tons, respectively.
* The volume range of trash in a dumpster in 2015 is `r range(subset(trash_data, year == "2015")$volume)[2] - range(subset(trash_data, year == "2015")$volume)[1]` cubic yards.
* The median number of sports balls in a dumpster in 2016 is `r median(subset(trash_data, year == "2016")$sports_balls)`.


Data frame `precipitation_data` contains information related to precipitation between January 2016 and August 2017. There is `r nrow(precipitation_data)` observations and `r ncol(precipitation_data)` in total. Variables indlude month, year, and precipitaion for each month.

* The total precipitaion in 2017 is `r sum(subset(precipitation_data, year == "2017")$precipitation)` inches.


# Problem 3

This problem uses the BRFSS data, and focus on the "Overall Health" topic.

### Import and tidy data

```{r brfss_data, warning = FALSE, message = FALSE}
# download p8105.datasets
devtools::install_github("p8105/p8105.datasets")
library(p8105.datasets)
# load BRFSS data from p8105.datasets
data("brfss_smart2010")

brfss_data = brfss_smart2010 %>%
  janitor::clean_names() %>%
  # format the data to use appropriate variable names
  separate(locationdesc, into = c("state_str", "location"), sep = " - ") %>%
  select(-state_str) %>%
  rename(state_abbr = locationabbr) %>%
  # focus on "Overall Health" topic
  filter(topic == "Overall Health") %>%
  # select the variables which I need
  select(-(class:question),
         -sample_size, 
         -(confidence_limit_low:geo_location)) %>%
  # structure data so that responses are variables taking the value of data_value
  spread(key = response, value = data_value) %>%
  # clean the new variable names (5 response variables)
  janitor::clean_names() %>%
  # place the response variables in a low-to-high order
  select(year:location, poor, fair, good, very_good, excellent) %>%
  # create a new variable showing the proportion of respnses that were "excellent" of "very good" (above "good")
  mutate(above_good = very_good + excellent)
```


### Some answers based on the data

```{r}
count_state = count(brfss_data, state_abbr) %>%
  # arrange the numbers in a descending order
  arrange(desc(n))

nrow(count_state)
max(count(brfss_data, state_abbr)$n)
head(count_state, 3)
```


* There are `r nrow(distinct(brfss_data, state_abbr, location))` unique locations being included in the dataset. Every state is represented. New Jersey the most observed state.

* In 2002, the median of the proportion of sujects with "Excellent" response value is `r median(subset(brfss_data, year == "2002")$excellent, na.rm = TRUE)`%.

* A histogram of "Excellent" response values in the year 2002.

```{r histogram, warning = FALSE, message = FALSE}
brfss_data %>%
  filter(year == "2002") %>%
  ggplot(aes(x = excellent)) + 
  geom_histogram() +
  labs(title = "Histogram of 'Excellent' response values in year 2002", 
       x = "'Excellent' response values", 
       y = "Frequency") +
  theme(plot.title = element_text(hjust = 0.5)) 
```

* Make a scatterplot showing the proportion of “Excellent” response values in New York County and Queens County in each year from 2002 to 2010.

```{r scatterplot}
brfss_data %>%
  filter(state_abbr == "NY") %>%
  filter(location == "New York County" | location == "Queens County") %>%
  ggplot(aes(x = year, y = excellent)) +
  geom_point(aes(color = location)) +
  labs(title = "Scatterplot of the proportion of “Excellent” response values in New York County and Queens County from 2002 to 2010",
       y = "proportion") +
  theme(plot.title = element_text(hjust = 0.5)) 

```


